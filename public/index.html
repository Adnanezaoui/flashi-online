
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØµÙˆØ± - Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', sans-serif;
        }
        body {
            background: linear-gradient(145deg, #0a1c23 0%, #06242e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }
        .game-wrapper {
            max-width: 1600px;
            width: 100%;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .main-game {
            flex: 2;
            min-width: 700px;
            background: #1f5568;
            border-radius: 60px 60px 40px 40px;
            padding: 30px 25px;
            box-shadow: 0 25px 35px rgba(0,0,0,0.7);
            border: 3px solid #6ec3d4;
        }
        .sidebar {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .leaderboard-panel {
            background: #163a47;
            border-radius: 50px;
            padding: 25px;
            box-shadow: 0 20px 30px rgba(0,0,0,0.6);
            border: 3px solid #fecb57;
            color: white;
        }
        .chat-panel {
            background: #0e2e3a;
            border-radius: 50px;
            padding: 25px;
            box-shadow: 0 20px 30px rgba(0,0,0,0.6);
            border: 3px solid #6ec3d4;
            color: white;
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        .admin-panel {
            background: #2a4a5a;
            border-radius: 50px;
            padding: 20px;
            border: 3px solid #ff6b6b;
            color: white;
            margin-top: 20px;
        }
        .flashi-header {
            background: #fecb57;
            padding: 15px 25px;
            border-radius: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: #0f3a44;
        }
        .logo {
            font-size: 28px;
        }
        .logo span {
            background: #0f3a44;
            color: #fecb57;
            padding: 6px 18px;
            border-radius: 40px;
            font-size: 18px;
            margin-right: 10px;
        }
        .player-panel {
            background: white;
            padding: 18px 22px;
            border-radius: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .name-field {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #e7f0f0;
            padding: 8px 22px;
            border-radius: 50px;
            flex: 1;
        }
        .name-field input {
            border: none;
            background: transparent;
            font-size: 18px;
            padding: 8px;
            border-bottom: 2px solid #3596a5;
            outline: none;
            width: 100%;
        }
        .btn {
            background: #fdca40;
            border: none;
            padding: 14px 32px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 7px 0 #b38f40;
            transition: 0.05s;
            border: 1px solid #ffeeaa;
            margin: 5px;
        }
        .btn:active {
            box-shadow: 0 2px 0 #b38f40;
            transform: translateY(5px);
        }
        .btn-admin {
            background: #ff6b6b;
            box-shadow: 0 7px 0 #b33f3f;
            color: white;
        }
        .btn-admin-active {
            background: #4caf50;
            box-shadow: 0 7px 0 #2d6e2d;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: white;
            font-size: 22px;
            background: #0d3a47;
            padding: 15px 25px;
            border-radius: 50px;
        }
        .images-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .img-holder {
            background: #1d5a6b;
            padding: 15px 15px 20px;
            border-radius: 30px;
            box-shadow: inset 0 -5px 0 #0f3a44;
        }
        .img-holder p {
            color: white;
            text-align: center;
            margin-bottom: 8px;
            font-size: 18px;
            font-weight: bold;
        }
        .game-canvas {
            width: 320px;
            height: 220px;
            border-radius: 25px;
            border: 4px solid #97d4d4;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .game-canvas img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        .score-timer {
            background: #0b323b;
            padding: 18px 25px;
            border-radius: 60px;
            display: flex;
            justify-content: space-between;
            color: #ffe485;
            font-size: 32px;
            font-weight: bold;
            margin-top: 20px;
        }
        .score-box, .timer-box, .players-count {
            background: #041e24;
            padding: 10px 30px;
            border-radius: 50px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .message-area {
            background: #fbdfa5;
            padding: 18px;
            border-radius: 40px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #1a4a55;
            margin-top: 22px;
            border: 4px dashed #3d8f8f;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #0a262e;
            border-radius: 30px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            padding: 10px 15px;
            background: #1e4e5c;
            border-radius: 25px;
            border-right: 5px solid #fecb57;
            word-wrap: break-word;
        }
        .chat-message-admin {
            border-right-color: #ff6b6b;
            background: #3a4a5a;
        }
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border-radius: 40px;
            border: none;
            background: #1e4e5c;
            color: white;
            font-size: 16px;
        }
        .chat-input::placeholder {
            color: #a0c0c8;
        }
        .admin-login {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .admin-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 40px;
            border: none;
            background: #1e4e5c;
            color: white;
        }
        .game-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .status-active { background: #4caf50; color: white; }
        .status-paused { background: #ff9800; color: white; }
        .status-stopped { background: #f44336; color: white; }
        .room-code {
            font-size: 24px;
            color: #fecb57;
            background: #0f3a44;
            padding: 8px 20px;
            border-radius: 40px;
            letter-spacing: 5px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="main-game">
            <div class="flashi-header">
                <div class="logo">
                    ğŸ¯ Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØµÙˆØ± 
                    <span>Flashi</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span id="gameStatusBadge" class="game-status status-active">ğŸŸ¢ Ù†Ø´Ø·</span>
                    <span class="room-code" id="roomCodeDisplay">ØºØ±ÙØ© 1234</span>
                </div>
            </div>
            
            <div class="player-panel">
                <div class="name-field">
                    <span style="font-size:28px;">ğŸ‘¤</span>
                    <input type="text" id="playerNameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" value="Ø²Ø§Ø¦Ø±">
                </div>
                <button id="enterGameBtn" class="btn">ğŸšª Ø¯Ø®ÙˆÙ„</button>
            </div>
            
            <div class="game-info">
                <span>ğŸ‘¥ Ø§Ù„Ø²Ø§Ø¦Ø±ÙŠÙ†: <span id="visitorCount">1</span></span>
                <span>ğŸ® ØµÙˆØ±Ø©: <span id="imageCounter">1/200</span></span>
                <span>â­ Ù†Ù‚Ø§Ø·Ùƒ: <span id="playerTotalScore">0</span></span>
            </div>
            
            <div class="images-row">
                <div class="img-holder">
                    <p>ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±Ø© Ø£</p>
                    <div class="game-canvas">
                        <img id="leftImage" src="" alt="Left Image">
                    </div>
                </div>
                <div class="img-holder">
                    <p>ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨</p>
                    <div class="game-canvas">
                        <img id="rightImage" src="" alt="Right Image">
                    </div>
                </div>
            </div>
            
            <div class="score-timer">
                <div class="score-box">
                    <span>ğŸ†</span>
                    <span id="scoreDisplay">0</span>
                </div>
                <div class="timer-box">
                    <span>â³</span>
                    <span id="timerDisplay">0:20</span>
                </div>
                <div class="players-count">
                    <span>ğŸ¯</span>
                    <span id="differencesLeft">5</span>
                </div>
            </div>
            
            <div id="messageBox" class="message-area">
                â° ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙŠØ§ <span id="playerNameSpan">Ø²Ø§Ø¦Ø±</span> Ø­ØªÙ‰ ØªØ¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            </div>
        </div>
        
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="sidebar">
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ -->
            <div class="leaderboard-panel">
                <div class="leaderboard-title" style="font-size: 28px; color: #fecb57; margin-bottom: 20px; text-align: center;">
                    ğŸ† Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨
                </div>
                <div class="visitor-counter" style="background: #0f3a44; padding: 15px; border-radius: 40px; text-align: center; margin-bottom: 20px;">
                    ğŸ® Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†: <span id="onlineCount">1</span> Ù„Ø§Ø¹Ø¨
                </div>
                <ul id="leaderboardList" style="list-style: none; padding: 0;">
                    <li style="background: #1e4e5c; padding: 15px 20px; margin-bottom: 10px; border-radius: 40px; display: flex; justify-content: space-between; border-right: 8px solid #fecb57;">
                        <span>ğŸ¥‡ Ø²Ø§Ø¦Ø±</span> <span>0</span>
                    </li>
                </ul>
            </div>
            
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
            <div class="admin-panel">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <span style="font-size: 24px;">ğŸ‘‘</span>
                    <span style="font-size: 24px; color: #ff6b6b;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ø£Ø¯Ù…Ù†</span>
                </div>
                
                <div class="admin-login">
                    <input type="password" id="adminPasswordInput" class="admin-input" placeholder="ğŸ”‘ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØºØ±ÙØ©" value="admin1234">
                    <button id="adminLoginBtn" class="btn btn-admin">ğŸ” Ø¯Ø®ÙˆÙ„</button>
                </div>
                
                <div id="adminControls" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button id="pauseGameBtn" class="btn" style="background: #ff9800; flex: 1;">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
                        <button id="resumeGameBtn" class="btn" style="background: #4caf50; flex: 1;">â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
                        <button id="nextImageBtn" class="btn" style="background: #2196f3; flex: 1;">â© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button id="resetGameBtn" class="btn" style="background: #f44336; flex: 1;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                        <button id="randomImageBtn" class="btn" style="background: #9c27b0; flex: 1;">ğŸ² ØµÙˆØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</button>
                    </div>
                    <p style="color: #a0e0e0; margin-top: 15px; font-size: 14px; text-align: center;">
                        âœ… Ø£Ù†Øª Ù…ØªØµÙ„ ÙƒØ£Ø¯Ù…Ù† - Ù„Ø¯ÙŠÙƒ ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„
                    </p>
                </div>
            </div>
            
            <!-- ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
            <div class="chat-panel">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <span style="font-size: 24px;">ğŸ’¬</span>
                    <span style="font-size: 24px; color: #6ec3d4;">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</span>
                    <span id="adminChatBadge" style="display: none; background: #ff6b6b; padding: 4px 12px; border-radius: 20px; font-size: 14px;">Ø£Ø¯Ù…Ù†</span>
                </div>
                
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-message">
                        <span style="color: #fecb57;">ğŸ–¥ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…:</span> Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." disabled>
                    <button id="sendChatBtn" class="btn" style="padding: 14px 25px;">ğŸ“¨</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------
        // Ù„Ø¹Ø¨Ø© Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØµÙˆØ± - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
        // 200 ØµÙˆØ±Ø© - Ù†Ø¸Ø§Ù… Ø£Ø¯Ù…Ù† - Ø¯Ø±Ø¯Ø´Ø© - ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„
        // ------------------------------------------------------
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let playerName = "Ø²Ø§Ø¦Ø±";
        let currentScore = 0;
        let totalScore = 0;
        let timeSeconds = 20;
        let gameActive = true;
        let gamePaused = false;
        let foundDiffCount = 0;
        let currentLevel = 0;
        let timerIntervalId = null;
        let nextRoundTimeout = null;
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù†
        let isAdmin = false;
        const ADMIN_PASSWORD = "admin1234";
        let roomCode = "ØºØ±ÙØ© " + Math.floor(Math.random() * 9000 + 1000);
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø²ÙˆØ§Ø± ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø©
        let visitors = [];
        let chatMessages = [];
        
        // ------------------------------------------------------
        // 200 ØµÙˆØ±Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© - ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        // ------------------------------------------------------
        function generateImageUrls() {
            const urls = [];
            // Ù‚ÙˆØ§Ø¹Ø¯ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
            const baseUrls = [
                "https://i.pinimg.com/736x/e3/43/2c/e3432cfb9c3e3b0f6c0c7a3e0e3c0b0c.jpg",
                "https://i.pinimg.com/736x/8a/1b/4c/8a1b4c0b3a5f2d1e6c7a8b9c0d1e2f3a.jpg",
                "https://i.pinimg.com/736x/5d/4e/3b/5d4e3b2a1c9f8e7d6c5b4a3f2e1d0c9b.jpg",
                "https://i.pinimg.com/736x/7e/6d/5c/7e6d5c4b3a2f1e0d9c8b7a6f5e4d3c2b.jpg",
                "https://i.pinimg.com/736x/2c/3d/4e/2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f.jpg",
                "https://i.pinimg.com/736x/9f/8e/7d/9f8e7d6c5b4a3f2e1d0c9b8a7f6e5d4c.jpg",
                "https://i.pinimg.com/736x/1a/2b/3c/1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d.jpg",
                "https://i.pinimg.com/736x/4b/5c/6d/4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e.jpg",
                "https://i.pinimg.com/736x/7c/8d/9e/7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f.jpg",
                "https://i.pinimg.com/736x/2e/3f/4a/2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b.jpg"
            ];
            
            for (let i = 0; i < 200; i++) {
                const baseIndex = i % baseUrls.length;
                const difficulty = i < 50 ? "easy" : (i < 120 ? "medium" : "hard");
                const diffCount = i < 50 ? 5 : (i < 120 ? 6 : (i < 180 ? 7 : 8));
                
                urls.push({
                    id: i + 1,
                    name: `ØµÙˆØ±Ø© ${i + 1}`,
                    difficulty: difficulty,
                    difficultyText: difficulty === "easy" ? "Ø³Ù‡Ù„" : (difficulty === "medium" ? "Ù…ØªÙˆØ³Ø·" : "ØµØ¹Ø¨"),
                    differencesCount: diffCount,
                    leftImage: baseUrls[baseIndex],
                    rightImage: baseUrls[baseIndex],
                    differences: generateDifferences(diffCount, i)
                });
            }
            return urls;
        }
        
        function generateDifferences(count, seed) {
            const diffs = [];
            const positions = [
                [0.15, 0.20], [0.45, 0.35], [0.70, 0.55], [0.25, 0.75], [0.85, 0.40],
                [0.12, 0.45], [0.55, 0.25], [0.35, 0.85], [0.75, 0.65], [0.95, 0.15],
                [0.08, 0.30], [0.48, 0.70], [0.62, 0.18], [0.28, 0.55], [0.82, 0.82],
                [0.18, 0.38], [0.52, 0.48], [0.68, 0.72], [0.32, 0.62], [0.88, 0.28]
            ];
            
            for (let i = 0; i < count; i++) {
                const pos = positions[i % positions.length];
                diffs.push({
                    x: pos[0] + (seed * 0.0001 * i) % 0.1,
                    y: pos[1] + (seed * 0.0001 * (i+1)) % 0.1,
                    r: 12 + (seed % 5),
                    found: false
                });
            }
            return diffs;
        }
        
        const levels = generateImageUrls();
        const TOTAL_IMAGES = levels.length;
        
        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const leftImage = document.getElementById('leftImage');
        const rightImage = document.getElementById('rightImage');
        const nameInput = document.getElementById('playerNameInput');
        const enterBtn = document.getElementById('enterGameBtn');
        const scoreSpan = document.getElementById('scoreDisplay');
        const timerSpan = document.getElementById('timerDisplay');
        const messageDiv = document.getElementById('messageBox');
        const playerNameSpan = document.getElementById('playerNameSpan');
        const imageCounter = document.getElementById('imageCounter');
        const differencesLeftSpan = document.getElementById('differencesLeft');
        const playerTotalScoreSpan = document.getElementById('playerTotalScore');
        const visitorCountSpan = document.getElementById('visitorCount');
        const onlineCountSpan = document.getElementById('onlineCount');
        const leaderboardList = document.getElementById('leaderboardList');
        const gameStatusBadge = document.getElementById('gameStatusBadge');
        const roomCodeDisplay = document.getElementById('roomCodeDisplay');
        
        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø¯Ù…Ù†
        const adminPasswordInput = document.getElementById('adminPasswordInput');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminControls = document.getElementById('adminControls');
        const pauseGameBtn = document.getElementById('pauseGameBtn');
        const resumeGameBtn = document.getElementById('resumeGameBtn');
        const nextImageBtn = document.getElementById('nextImageBtn');
        const resetGameBtn = document.getElementById('resetGameBtn');
        const randomImageBtn = document.getElementById('randomImageBtn');
        
        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');
        const adminChatBadge = document.getElementById('adminChatBadge');
        
        // Ø¹Ø±Ø¶ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
        roomCodeDisplay.innerText = roomCode;
        
        // ------------------------------------------------------
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ------------------------------------------------------
        
        function loadLevel(levelIndex) {
            if (!gameActive || gamePaused) return;
            
            currentLevel = levelIndex % TOTAL_IMAGES;
            const level = levels[currentLevel];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            imageCounter.innerText = `${currentLevel+1}/${TOTAL_IMAGES}`;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
            leftImage.src = level.leftImage;
            rightImage.src = level.rightImage;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª
            levels.forEach(l => l.differences?.forEach(d => d.found = false));
            level.differences.forEach(d => d.found = false);
            foundDiffCount = 0;
            differencesLeftSpan.innerText = level.differencesCount;
        }
        
        function handleImageClick(e) {
            if (!gameActive || gamePaused) {
                alert(gamePaused ? 'â¸ï¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø¯Ù…Ù†' : 'âš ï¸ Ø§Ù„Ø¬ÙˆÙ„Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯!');
                return;
            }
            
            const img = e.target;
            const rect = img.getBoundingClientRect();
            const scaleX = img.naturalWidth / rect.width;
            const scaleY = img.naturalHeight / rect.height;
            
            const x = (e.clientX - rect.left) * scaleX / img.naturalWidth;
            const y = (e.clientY - rect.top) * scaleY / img.naturalHeight;
            
            const level = levels[currentLevel];
            let found = false;
            
            for (let i = 0; i < level.differences.length; i++) {
                const d = level.differences[i];
                if (d.found) continue;
                
                const dx = x - d.x;
                const dy = y - d.y;
                if (Math.sqrt(dx*dx + dy*dy) < 0.05) {
                    d.found = true;
                    foundDiffCount++;
                    currentScore += 1;
                    totalScore += 1;
                    scoreSpan.innerText = currentScore;
                    playerTotalScoreSpan.innerText = totalScore;
                    found = true;
                    
                    differencesLeftSpan.innerText = level.differencesCount - foundDiffCount;
                    
                    updateLeaderboard();
                    
                    if (foundDiffCount === level.differencesCount) {
                        endLevel(true);
                    }
                    break;
                }
            }
        }
        
        function startTimer() {
            if (timerIntervalId) clearInterval(timerIntervalId);
            timeSeconds = 20;
            updateTimer();
            timerIntervalId = setInterval(() => {
                if (gameActive && !gamePaused) {
                    timeSeconds--;
                    updateTimer();
                    if (timeSeconds <= 0) {
                        timeSeconds = 0;
                        updateTimer();
                        endLevel(false);
                    }
                }
            }, 1000);
        }
        
        function updateTimer() {
            let secs = timeSeconds;
            timerSpan.innerText = `0:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        function startGame() {
            let name = nameInput.value.trim();
            if (name === '') {
                alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹');
                return;
            }
            
            playerName = name;
            playerNameSpan.innerText = playerName;
            
            addVisitor(playerName);
            
            gameActive = true;
            currentScore = 0;
            scoreSpan.innerText = '0';
            currentLevel = Math.floor(Math.random() * TOTAL_IMAGES);
            loadLevel(currentLevel);
            
            if (timerIntervalId) clearInterval(timerIntervalId);
            if (nextRoundTimeout) clearTimeout(nextRoundTimeout);
            startTimer();
            
            messageDiv.innerHTML = `ğŸ”¥ Ø§Ù„Ù„Ø¹Ø¨ Ù†Ø´Ø·! Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª ÙŠØ§ ${playerName}`;
            messageDiv.style.background = '#c1e5d4';
            
            addChatMessage('ğŸ–¥ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…', `${playerName} Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©`, false);
        }
        
        function endLevel(won) {
            if (!gameActive) return;
            
            gameActive = false;
            clearInterval(timerIntervalId);
            
            const level = levels[currentLevel];
            
            if (won) {
                messageDiv.innerHTML = `ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙˆØ¬Ø¯Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª!`;
                
                if (!gamePaused) {
                    nextRoundTimeout = setTimeout(() => {
                        if (!gamePaused) {
                            currentLevel = (currentLevel + 1) % TOTAL_IMAGES;
                            loadLevel(currentLevel);
                            gameActive = true;
                            currentScore = 0;
                            scoreSpan.innerText = '0';
                            timeSeconds = 20;
                            startTimer();
                            messageDiv.innerHTML = `ğŸ”¥ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${currentLevel+1}! Ø§Ø¨Ø­Ø« Ø¹Ù† ${levels[currentLevel].differencesCount} Ø§Ø®ØªÙ„Ø§ÙØ§Øª`;
                        }
                    }, 10000);
                }
            } else {
                messageDiv.innerHTML = `â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!`;
                
                if (!gamePaused) {
                    nextRoundTimeout = setTimeout(() => {
                        if (!gamePaused) {
                            currentLevel = (currentLevel + 1) % TOTAL_IMAGES;
                            loadLevel(currentLevel);
                            gameActive = true;
                            currentScore = 0;
                            scoreSpan.innerText = '0';
                            timeSeconds = 20;
                            startTimer();
                            messageDiv.innerHTML = `ğŸ”¥ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${currentLevel+1}! Ø§Ø¨Ø­Ø« Ø¹Ù† ${levels[currentLevel].differencesCount} Ø§Ø®ØªÙ„Ø§ÙØ§Øª`;
                        }
                    }, 10000);
                }
            }
        }
        
        // ------------------------------------------------------
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù†
        // ------------------------------------------------------
        
        adminLoginBtn.addEventListener('click', function() {
            const password = adminPasswordInput.value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                adminControls.style.display = 'block';
                adminLoginBtn.style.background = '#4caf50';
                adminLoginBtn.innerText = 'âœ… Ù…ØªØµÙ„';
                adminPasswordInput.disabled = true;
                adminChatBadge.style.display = 'inline-block';
                chatInput.disabled = false;
                chatInput.placeholder = 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ ÙƒØ£Ø¯Ù…Ù†...';
                addChatMessage('ğŸ–¥ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…', 'Ø£Ø¯Ù…Ù† Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©', true);
            } else {
                alert('âŒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©');
            }
        });
        
        pauseGameBtn.addEventListener('click', function() {
            gamePaused = true;
            gameActive = false;
            gameStatusBadge.className = 'game-status status-paused';
            gameStatusBadge.innerHTML = 'ğŸŸ¡ Ù…ØªÙˆÙ‚ÙØ© Ù…Ø¤Ù‚ØªØ§Ù‹';
            messageDiv.innerHTML = 'â¸ï¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø¯Ù…Ù†';
            addChatMessage('ğŸ‘‘ Ø§Ù„Ø£Ø¯Ù…Ù†', 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø¤Ù‚ØªØ§Ù‹', true);
        });
        
        resumeGameBtn.addEventListener('click', function() {
            gamePaused = false;
            gameActive = true;
            gameStatusBadge.className = 'game-status status-active';
            gameStatusBadge.innerHTML = 'ğŸŸ¢ Ù†Ø´Ø·';
            messageDiv.innerHTML = `ğŸ”¥ Ø§Ù„Ù„Ø¹Ø¨ Ù†Ø´Ø·! Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª ÙŠØ§ ${playerName}`;
            startTimer();
            addChatMessage('ğŸ‘‘ Ø§Ù„Ø£Ø¯Ù…Ù†', 'â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©', true);
        });
        
        nextImageBtn.addEventListener('click', function() {
            if (isAdmin) {
                clearTimeout(nextRoundTimeout);
                currentLevel = (currentLevel + 1) % TOTAL_IMAGES;
                loadLevel(currentLevel);
                gameActive = true;
                currentScore = 0;
                scoreSpan.innerText = '0';
                timeSeconds = 20;
                startTimer();
                messageDiv.innerHTML = `ğŸ”¥ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${currentLevel+1}! Ø§Ø¨Ø­Ø« Ø¹Ù† ${levels[currentLevel].differencesCount} Ø§Ø®ØªÙ„Ø§ÙØ§Øª`;
                addChatMessage('ğŸ‘‘ Ø§Ù„Ø£Ø¯Ù…Ù†', `â© ØªØ®Ø·Ù‰ Ø¥Ù„Ù‰ ØµÙˆØ±Ø© ${currentLevel+1}`, true);
            }
        });
        
        resetGameBtn.addEventListener('click', function() {
            if (isAdmin) {
                totalScore = 0;
                playerTotalScoreSpan.innerText = '0';
                currentLevel = 0;
                loadLevel(0);
                gameActive = true;
                currentScore = 0;
                scoreSpan.innerText = '0';
                timeSeconds = 20;
                startTimer();
                messageDiv.innerHTML = 'ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©';
                addChatMessage('ğŸ‘‘ Ø§Ù„Ø£Ø¯Ù…Ù†', 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', true);
                updateLeaderboard();
            }
        });
        
        randomImageBtn.addEventListener('click', function() {
            if (isAdmin) {
                currentLevel = Math.floor(Math.random() * TOTAL_IMAGES);
                loadLevel(currentLevel);
                gameActive = true;
                currentScore = 0;
                scoreSpan.innerText = '0';
                timeSeconds = 20;
                startTimer();
                messageDiv.innerHTML = `ğŸ² ØµÙˆØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©! Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${currentLevel+1}`;
                addChatMessage('ğŸ‘‘ Ø§Ù„Ø£Ø¯Ù…Ù†', `ğŸ² ØµÙˆØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ${currentLevel+1}`, true);
            }
        });
        
        // ------------------------------------------------------
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        // ------------------------------------------------------
        
        function addChatMessage(sender, message, isAdmin = false) {
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${isAdmin ? 'chat-message-admin' : ''}`;
            
            const senderSpan = document.createElement('span');
            senderSpan.style.color = isAdmin ? '#ff6b6b' : '#fecb57';
            senderSpan.style.fontWeight = 'bold';
            senderSpan.innerText = `${isAdmin ? 'ğŸ‘‘' : 'ğŸ‘¤'} ${sender}: `;
            
            const messageSpan = document.createElement('span');
            messageSpan.style.color = 'white';
            messageSpan.innerText = message;
            
            messageElement.appendChild(senderSpan);
            messageElement.appendChild(messageSpan);
            chatMessages.appendChild(messageElement);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Ø­ÙØ¸ Ø¢Ø®Ø± 50 Ø±Ø³Ø§Ù„Ø© ÙÙ‚Ø·
            if (chatMessages.children.length > 50) {
                chatMessages.removeChild(chatMessages.children[0]);
            }
        }
        
        sendChatBtn.addEventListener('click', function() {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            if (isAdmin) {
                addChatMessage(`Ø£Ø¯Ù…Ù† ${playerName}`, message, true);
            } else {
                addChatMessage(playerName, message, false);
            }
            
            chatInput.value = '';
        });
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatBtn.click();
            }
        });
        
        // ------------------------------------------------------
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø²ÙˆØ§Ø± ÙˆØ§Ù„ØªØ±ØªÙŠØ¨
        // ------------------------------------------------------
        
        function addVisitor(name) {
            let existing = visitors.find(v => v.name === name);
            if (existing) {
                existing.score = totalScore;
            } else {
                visitors.push({ name: name, score: totalScore });
            }
            
            visitors.sort((a, b) => b.score - a.score);
            updateLeaderboard();
        }
        
        function updateLeaderboard() {
            let existing = visitors.find(v => v.name === playerName);
            if (existing) {
                existing.score = totalScore;
            } else {
                visitors.push({ name: playerName, score: totalScore });
            }
            
            visitors.sort((a, b) => b.score - a.score);
            
            let html = '';
            visitors.slice(0, 7).forEach((v, i) => {
                let rankClass = '';
                let medal = '';
                if (i === 0) { rankClass = 'rank-1'; medal = 'ğŸ¥‡'; }
                else if (i === 1) { rankClass = 'rank-2'; medal = 'ğŸ¥ˆ'; }
                else if (i === 2) { rankClass = 'rank-3'; medal = 'ğŸ¥‰'; }
                else medal = `${i+1}.`;
                
                html += `<li style="background: #1e4e5c; padding: 15px 20px; margin-bottom: 10px; border-radius: 40px; display: flex; justify-content: space-between; border-right: 8px solid ${i === 0 ? 'gold' : (i === 1 ? 'silver' : (i === 2 ? '#cd7f32' : '#fecb57'))};">
                    <span>${medal} ${v.name}</span> <span>${v.score}</span>
                </li>`;
            });
            leaderboardList.innerHTML = html;
            
            onlineCountSpan.innerText = visitors.length;
            visitorCountSpan.innerText = visitors.length;
        }
        
        // ------------------------------------------------------
        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
        // ------------------------------------------------------
        
        rightImage.addEventListener('click', handleImageClick);
        leftImage.addEventListener('click', handleImageClick);
        enterBtn.addEventListener('click', startGame);
        
        nameInput.addEventListener('input', function() {
            let val = this.value.trim();
            if (val !== '') playerNameSpan.innerText = val;
        });
        
        // Ø²ÙˆØ§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ†
        visitors.push({ name: 'Ø²Ø§Ø¦Ø±', score: 0 });
        visitors.push({ name: 'Ø¶ÙŠÙ', score: 0 });
        visitors.push({ name: 'Ù„Ø§Ø¹Ø¨', score: 0 });
        updateLeaderboard();
        
        // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ ØµÙˆØ±Ø©
        loadLevel(0);
        
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„Ø²ÙˆØ§Ø±
        chatInput.disabled = false;
        chatInput.placeholder = 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...';
    </script>
</body>
</html>
