<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POLO - Ù„Ø¹Ø¨Ø© Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØµÙˆØ±</title>
<style>
body { font-family:'Cairo',sans-serif; background:#0a1c23; color:white; text-align:center; margin:0; padding:0;}
button { padding:10px 20px; margin:5px; border-radius:10px; font-size:16px; cursor:pointer; }
#gamePage { display:none; }
#loginPage { margin-top:50px;}
#images { margin-top:20px; position: relative; display: flex; justify-content: center; gap: 20px;}
.image-holder { position: relative; }
img { width:300px; height:200px; cursor:pointer; border:3px solid #fff; border-radius:10px; }
.mark { position:absolute; border:3px solid lime; border-radius:50%; width:30px; height:30px; transform: translate(-50%,-50%); pointer-events:none; }
table { width:80%; margin:auto; border-collapse: collapse; margin-top:10px;}
table, th, td { border:1px solid #fff; padding:8px;}
th { background:#1e4e5c; }
td { background:#163a47; }
#adminControls { margin:15px;}
#timer { font-size:32px; margin-top:10px; color:#fdca40;}
</style>
</head>
<body>

<div id="loginPage">
  <h1>ğŸ”¥ POLO ğŸ”¥</h1>
  <h3>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</h3>
  <button id="playerLoginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
  <button id="adminLoginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</button>

  <div id="playerForm" style="display:none; margin-top:15px;">
    <input type="text" id="playerName" placeholder="Ø§Ø³Ù…Ùƒ">
    <input type="password" id="playerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button id="loginPlayerSubmit">Ø¯Ø®ÙˆÙ„</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <div id="adminForm" style="display:none; margin-top:15px;">
    <input type="text" id="adminName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù†">
    <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†">
    <button id="loginAdminSubmit">Ø¯Ø®ÙˆÙ„</button>
    <p id="adminError" style="color:red;"></p>
  </div>
</div>

<div id="gamePage">
  <h2>Ù…Ø±Ø­Ø¨Ø§ <span id="displayName"></span></h2>

  <div id="adminControls" style="display:none;">
    <button id="startRoundBtn">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
    <button id="stopRoundBtn">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  </div>

  <div id="timer">15</div>

  <div id="images">
    <div class="image-holder">
      <img id="leftImg" src="">
    </div>
    <div class="image-holder">
      <img id="rightImg" src="">
    </div>
  </div>

  <div id="playerList"></div>
  <div id="roundResults" style="display:none;"></div>
</div>

<script>
let isAdmin = false;
let playerName = '';
let roundTime = 15;
let timerInterval = null;
let gameActive = false;
let currentLevel = 0;
let totalRounds = 300; // Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±
let rounds = [];
let differencesCount = 5; // Ø§Ø®ØªÙ„Ø§ÙØ§Øª Ù„ÙƒÙ„ ØµÙˆØ±Ø© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ¹ÙˆØ¨Ø©)
let playerScores = {};
let marks = [];

// ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ·Ø§Ø¨Ù‚Ø© + Ø§Ø®ØªÙ„Ø§ÙØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
function generateRounds() {
    for(let i=0;i<totalRounds;i++){
        let imgUrl = `https://picsum.photos/seed/${i}/300/200`;
        let diffs = [];
        for(let j=0;j<differencesCount;j++){
            diffs.push({x: Math.random(), y: Math.random(), found:false});
        }
        rounds.push({img: imgUrl, diffs});
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
function loadRound(index){
    currentLevel = index;
    const round = rounds[currentLevel];
    document.getElementById('leftImg').src = round.img;
    document.getElementById('rightImg').src = round.img;
    clearMarks();
}

// Ø­Ø°Ù Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
function clearMarks(){
    marks.forEach(m => m.remove());
    marks = [];
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
function startTimer(){
    roundTime = 15;
    document.getElementById('timer').innerText = roundTime;
    timerInterval = setInterval(()=>{
        if(!gameActive) return;
        roundTime--;
        document.getElementById('timer').innerText = roundTime;
        if(roundTime <=0){
            endRound();
        }
    },1000);
}

// Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function endRound(){
    gameActive=false;
    clearInterval(timerInterval);
    showRoundResults();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
function showRoundResults(){
    let resultsDiv = document.getElementById('roundResults');
    let html = '<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø© '+(currentLevel+1)+'</h3><table><tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr>';
    for(const p in playerScores){
        html+=`<tr><td>${p}</td><td>${playerScores[p]}</td></tr>`;
    }
    html+='</table>';
    resultsDiv.innerHTML = html;
    resultsDiv.style.display='block';
    document.getElementById('images').style.display='none';

    setTimeout(()=>{
        resultsDiv.style.display='none';
        document.getElementById('images').style.display='flex';
        if(currentLevel+1<rounds.length){
            loadRound(currentLevel+1);
            if(isAdmin) gameActive=true;
            startTimer();
        }
    },10000);
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
function imageClick(e){
    if(!gameActive) return;
    const rect = e.target.getBoundingClientRect();
    const round = rounds[currentLevel];
    for(let d of round.diffs){
        if(d.found) continue;
        const dx = (e.clientX - rect.left)/rect.width;
        const dy = (e.clientY - rect.top)/rect.height;
        if(Math.abs(dx - d.x)<0.05 && Math.abs(dy - d.y)<0.05){
            d.found=true;
            // Ø¹Ù…Ù„ Ø¹Ù„Ø§Ù…Ø© Ø®Ø¶Ø±Ø§Ø¡
            let mark = document.createElement('div');
            mark.className='mark';
            mark.style.left = (dx*100)+'%';
            mark.style.top = (dy*100)+'%';
            e.target.parentElement.appendChild(mark);
            marks.push(mark);
            // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·
            if(!playerScores[playerName]) playerScores[playerName]=0;
            playerScores[playerName]++;
        }
    }
}

// Ø£Ø­Ø¯Ø§Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById('playerLoginBtn').onclick = ()=>{
    document.getElementById('playerForm').style.display='block';
    document.getElementById('adminForm').style.display='none';
}
document.getElementById('adminLoginBtn').onclick = ()=>{
    document.getElementById('adminForm').style.display='block';
    document.getElementById('playerForm').style.display='none';
}
document.getElementById('loginPlayerSubmit').onclick = ()=>{
    let name = document.getElementById('playerName').value.trim();
    let pass = document.getElementById('playerPassword').value.trim();
    if(pass !== 'POLO FAMILY'){ document.getElementById('loginError').innerText='ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'; return;}
    if(name===''){ document.getElementById('loginError').innerText='Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ'; return;}
    playerName=name;
    document.getElementById('displayName').innerText=playerName;
    document.getElementById('loginPage').style.display='none';
    document.getElementById('gamePage').style.display='block';
    loadRound(0);
    gameActive=true;
    startTimer();
}
document.getElementById('loginAdminSubmit').onclick = ()=>{
    let name = document.getElementById('adminName').value.trim();
    let pass = document.getElementById('adminPassword').value.trim();
    if(pass !== 'ADMINPOLO'){ document.getElementById('adminError').innerText='ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'; return;}
    playerName=name;
    isAdmin=true;
    document.getElementById('displayName').innerText=playerName+' (Admin)';
    document.getElementById('loginPage').style.display='none';
    document.getElementById('gamePage').style.display='block';
    document.getElementById('adminControls').style.display='block';
    loadRound(0);
}

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø§Ø¯Ù…Ù†
document.getElementById('startRoundBtn').onclick = ()=>{
    gameActive=true;
    startTimer();
}
document.getElementById('stopRoundBtn').onclick = ()=>{
    gameActive=false;
    clearInterval(timerInterval);
}

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±
document.getElementById('leftImg').onclick=imageClick;
document.getElementById('rightImg').onclick=imageClick;

// ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¬ÙˆÙ„Ø§Øª
generateRounds();
</script>

</body>
</html>
