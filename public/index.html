<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÑÿπÿ®ÿ© ÿßÿÆÿ™ŸÑÿßŸÅ ÿßŸÑÿµŸàÿ± - ÿßŸÑÿ®ÿ∑ŸàŸÑÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©</title>
    <style>
        /* (your existing styles unchanged ‚Äî omitted here for brevity) */
    </style>
</head>
<body>

<!-- POLO Login -->
<div id="poloLoginPage" style="text-align:center; color:white;">
    <h1 style="font-size:60px; margin-bottom:30px;">üî• POLO üî•</h1>
    <input type="text" id="poloPlayerName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ" style="..."><br>
    <input type="password" id="poloPassword" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" style="..."><br><br>
    <button onclick="enterPolo()" style="...">ÿØÿÆŸàŸÑ</button>
    <p id="poloError" style="color:red; margin-top:15px;"></p>
</div>

<!-- Main Game -->
<div class="game-wrapper" id="mainGame" style="display:none;">
    <!-- (your full game HTML structure as before) -->
</div>

<script>
    // ------------------------------------------------------
    // Variables & Game Setup
    // ------------------------------------------------------
    let playerName = "ÿ≤ÿßÿ¶ÿ±";
    let currentScore = 0, totalScore = 0, timeSeconds = 20;
    let gameActive = false, gamePaused = false;
    let foundDiffCount = 0, currentLevel = 0;
    let timerIntervalId = null, nextRoundTimeout = null;
    const levels = generateImageUrls();
    const TOTAL_IMAGES = levels.length;

    // DOM Elements
    const leftImage = document.getElementById('leftImage'),
          rightImage = document.getElementById('rightImage'),
          nameInput = document.getElementById('playerNameInput'),
          enterBtn = document.getElementById('enterGameBtn'),
          scoreSpan = document.getElementById('scoreDisplay'),
          timerSpan = document.getElementById('timerDisplay'),
          messageDiv = document.getElementById('messageBox'),
          playerNameSpan = document.getElementById('playerNameSpan'),
          imageCounter = document.getElementById('imageCounter'),
          differencesLeftSpan = document.getElementById('differencesLeft'),
          playerTotalScoreSpan = document.getElementById('playerTotalScore'),
          visitorCountSpan = document.getElementById('visitorCount'),
          onlineCountSpan = document.getElementById('onlineCount'),
          leaderboardList = document.getElementById('leaderboardList'),
          gameStatusBadge = document.getElementById('gameStatusBadge'),
          roomCodeDisplay = document.getElementById('roomCodeDisplay');

    const adminPasswordInput = document.getElementById('adminPasswordInput'),
          adminLoginBtn = document.getElementById('adminLoginBtn'),
          adminControls = document.getElementById('adminControls'),
          pauseGameBtn = document.getElementById('pauseGameBtn'),
          resumeGameBtn = document.getElementById('resumeGameBtn'),
          nextImageBtn = document.getElementById('nextImageBtn'),
          resetGameBtn = document.getElementById('resetGameBtn'),
          randomImageBtn = document.getElementById('randomImageBtn');

    const chatMessagesDiv = document.getElementById('chatMessages'),
          chatInput = document.getElementById('chatInput'),
          sendChatBtn = document.getElementById('sendChatBtn'),
          adminChatBadge = document.getElementById('adminChatBadge');

    let visitors = [];

    roomCodeDisplay.innerText = "ÿ∫ÿ±ŸÅÿ© " + Math.floor(Math.random() * 9000 + 1000);

    // ------------------------------------------------------
    // Game Functions (same as before, no eval!)
    // ------------------------------------------------------

    function generateImageUrls() {
        const urls = [];
        const baseUrls = [
            "https://i.pinimg.com/736x/e3/43/2c/e3432cfb9c3e3b0f6c0c7a3e0e3c0b0c.jpg",
            "https://i.pinimg.com/736x/8a/1b/4c/8a1b4c0b3a5f2d1e6c7a8b9c0d1e2f3a.jpg"
            // etc...
        ];
        for (let i = 0; i < 200; i++) {
            const diffCount = i < 50 ? 5 : (i < 120 ? 6 : 7);
            urls.push({
                id: i + 1,
                leftImage: baseUrls[i % baseUrls.length],
                rightImage: baseUrls[i % baseUrls.length],
                differencesCount: diffCount,
                differences: generateDifferences(diffCount, i)
            });
        }
        return urls;
    }

    function generateDifferences(count, seed) {
        const diffs = [], positions = [
            [0.15, 0.20], [0.45, 0.35], [0.70, 0.55]
        ];
        for (let i = 0; i < count; i++) {
            const pos = positions[i % positions.length];
            diffs.push({ x: pos[0], y: pos[1], r: 12, found: false });
        }
        return diffs;
    }

    function loadLevel(levelIndex) {
        if (!gameActive || gamePaused) return;
        currentLevel = levelIndex % TOTAL_IMAGES;
        const level = levels[currentLevel];
        imageCounter.innerText = `${currentLevel+1}/${TOTAL_IMAGES}`;
        leftImage.src = level.leftImage;
        rightImage.src = level.rightImage;
        foundDiffCount = 0;
        differencesLeftSpan.innerText = level.differencesCount;
    }

    function startTimer() {
        clearInterval(timerIntervalId);
        timeSeconds = 20;
        timerIntervalId = setInterval(() => {
            if (!gamePaused && gameActive) {
                timeSeconds--;
                timerSpan.innerText = `0:${timeSeconds < 10 ? "0" : ""}${timeSeconds}`;
                if (timeSeconds <= 0) endLevel(false);
            }
        }, 1000);
    }

    function startGame() {
        const name = nameInput.value.trim();
        if (!name) return alert('‚ùå ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ® ŸÑÿß ŸäŸÖŸÉŸÜ ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÅÿßÿ±ÿ∫ÿßŸã');
        playerName = name;
        playerNameSpan.innerText = name;
        gameActive = true;
        currentScore = 0;
        scoreSpan.innerText = '0';
        currentLevel = Math.floor(Math.random() * TOTAL_IMAGES);
        loadLevel(currentLevel);
        startTimer();
        messageDiv.innerText = `üî• ÿßŸÑŸÑÿπÿ® ŸÜÿ¥ÿ∑! ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿßÿÆÿ™ŸÑÿßŸÅÿßÿ™ Ÿäÿß ${name}`;
        visitors.push({ name, score: 0 });
        updateLeaderboard();
    }

    function endLevel(won) {
        clearInterval(timerIntervalId);
        messageDiv.innerText = won ? "üéâ Ÿàÿ¨ÿØÿ™ ŸÉŸÑ ÿßŸÑÿßÿÆÿ™ŸÑÿßŸÅÿßÿ™!" : "‚è∞ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!";
        nextRoundTimeout = setTimeout(() => {
            loadLevel(currentLevel + 1);
            gameActive = true;
            startTimer();
        }, 5000);
    }

    function updateLeaderboard() {
        visitors.sort((a,b) => b.score - a.score);
        leaderboardList.innerHTML = visitors.map(v =>
            `<li>${v.name}: ${v.score}</li>`
        ).join('');
        onlineCountSpan.innerText = visitors.length;
        visitorCountSpan.innerText = visitors.length;
    }

    leftImage.addEventListener('click', startGame);
    rightImage.addEventListener('click', startGame);
    enterBtn.addEventListener('click', startGame);

    // ------------------------------------------------------
    // POLO Login
    // ------------------------------------------------------
    function enterPolo() {
        const name = document.getElementById("poloPlayerName").value.trim();
        const password = document.getElementById("poloPassword").value.trim();
        if (password !== "POLO FAMILY") {
            document.getElementById("poloError").innerText = "‚ùå ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©";
            return;
        }
        if (!name) {
            document.getElementById("poloError").innerText = "‚ùå ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿßÿ≥ŸÖ";
            return;
        }
        playerName = name;
        document.getElementById("playerNameInput").value = name;
        playerNameSpan.innerText = name;
        document.getElementById("poloLoginPage").style.display = "none";
        document.getElementById("mainGame").style.display = "flex";
    }
</script>

</body>
</html>
