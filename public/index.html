<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POLO - Ù„Ø¹Ø¨Ø© Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØµÙˆØ±</title>
<style>
body { font-family: Cairo,sans-serif; background:#06242e; color:white; text-align:center; margin:0; padding:0;}
#loginPage, #gamePage, #resultsPage { display:none; padding:20px;}
input { padding:10px 15px; border-radius:30px; border:none; font-size:16px; margin:5px;}
button { padding:10px 20px; border-radius:30px; border:none; cursor:pointer; font-size:16px; margin:5px;}
#imagesRow { display:flex; justify-content:center; gap:20px; margin-top:20px;}
.gameImage { width:320px; height:220px; border:4px solid #97d4d4; border-radius:20px; cursor:pointer;}
table { width:80%; margin:20px auto; border-collapse:collapse; }
th, td { border:1px solid white; padding:10px; font-size:18px; }
th { background:#1f5568; }
</style>
</head>
<body>

<div id="loginPage">
<h1>ğŸ”¥ POLO ğŸ”¥</h1>
<button onclick="showPlayerLogin()">Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø¹Ø¨</button>
<button onclick="showAdminLogin()">Ø¯Ø®ÙˆÙ„ Ø£Ø¯Ù…Ù†</button>

<div id="playerLogin" style="display:none; margin-top:20px;">
<input id="playerName" placeholder="Ø§Ø³Ù…Ùƒ"><br>
<input id="playerPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
<button onclick="joinGame(false)">Ø¯Ø®ÙˆÙ„</button>
<p id="playerError" style="color:red;"></p>
</div>

<div id="adminLogin" style="display:none; margin-top:20px;">
<input id="adminName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù†"><br>
<input id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
<button onclick="joinGame(true)">Ø¯Ø®ÙˆÙ„</button>
<p id="adminError" style="color:red;"></p>
</div>
</div>

<div id="gamePage">
<h2>Ù…Ø±Ø­Ù„Ø© <span id="roundNum"></span></h2>
<p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer">0</span> Ø«ÙˆØ§Ù†ÙŠ</p>
<div id="imagesRow">
<img id="leftImage" class="gameImage">
<img id="rightImage" class="gameImage">
</div>
<p>Ù†Ù‚Ø§Ø·Ùƒ: <span id="playerScore">0</span> | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="playerTotal">0</span></p>
<h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†:</h3>
<ul id="playersList"></ul>
<button id="startBtn" style="display:none;" onclick="startRound()">â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
<button id="stopBtn" style="display:none;" onclick="stopGame()">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="resultsPage">
<h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø© <span id="resultsRound"></span></h2>
<table>
<thead>
<tr><th>Ø§Ù„ØªØ±ØªÙŠØ¨</th><th>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø©</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th></tr>
</thead>
<tbody id="resultsTable"></tbody>
</table>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let isAdmin = false;
let playerName = '';

function showPlayerLogin() {
    document.getElementById('playerLogin').style.display='block';
    document.getElementById('adminLogin').style.display='none';
}
function showAdminLogin() {
    document.getElementById('playerLogin').style.display='none';
    document.getElementById('adminLogin').style.display='block';
}

function joinGame(admin=false) {
    if(admin){
        const name = document.getElementById('adminName').value.trim();
        const pass = document.getElementById('adminPass').value.trim();
        if(pass!=='ADMINPOLO'){ document.getElementById('adminError').innerText='âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©'; return;}
        playerName = name || 'Admin';
        isAdmin=true;
    }else{
        const name = document.getElementById('playerName').value.trim();
        const pass = document.getElementById('playerPass').value.trim();
        if(pass!=='POLO FAMILY'){ document.getElementById('playerError').innerText='âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©'; return;}
        playerName=name || 'Ø²Ø§Ø¦Ø±';
    }
    socket.emit('join',{name:playerName,isAdmin});
    document.getElementById('loginPage').style.display='none';
    document.getElementById('gamePage').style.display='block';
    if(isAdmin){ document.getElementById('startBtn').style.display='inline-block'; document.getElementById('stopBtn').style.display='inline-block'; }
}

// Update players list
socket.on('players', list=>{
    const ul=document.getElementById('playersList');
    ul.innerHTML='';
    list.forEach(p=>{ const li=document.createElement('li'); li.innerText=`${p.name} - Ù†Ù‚Ø§Ø·: ${p.totalScore}`; ul.appendChild(li); });
});

// New round
socket.on('newRound', data=>{
    document.getElementById('gamePage').style.display='block';
    document.getElementById('resultsPage').style.display='none';
    document.getElementById('roundNum').innerText=data.round;
    document.getElementById('leftImage').src=data.image.left;
    document.getElementById('rightImage').src=data.image.right;
    document.getElementById('playerScore').innerText='0';
    document.getElementById('playerTotal').innerText=playersTotalScore();
});

// Timer
socket.on('timer', t=>{
    document.getElementById('timer').innerText=t;
});

// Round ended
socket.on('roundEnded', results=>{
    document.getElementById('gamePage').style.display='none';
    document.getElementById('resultsPage').style.display='block';
    document.getElementById('resultsRound').innerText=results[0]?.round||'';
    const tbody=document.getElementById('resultsTable');
    tbody.innerHTML='';
    results.sort((a,b)=>b.totalScore-a.totalScore).forEach((p,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td><td>${p.name}</td><td>${p.score}</td><td>${p.totalScore}</td>`;
        tbody.appendChild(tr);
    });
});

function startRound(){ socket.emit('startRound'); }
function stopGame(){ location.reload(); }

function playersTotalScore(){
    const ul=document.getElementById('playersList');
    return Array.from(ul.children).find(li=>li.innerText.includes(playerName))?.innerText.split('Ù†Ù‚Ø§Ø·: ')[1]||0;
}

// Handle clicking images (each difference = 1 point)
document.getElementById('leftImage').addEventListener('click', ()=>socket.emit('foundDifference',{points:1}));
document.getElementById('rightImage').addEventListener('click', ()=>socket.emit('foundDifference',{points:1}));
</script>
</body>
</html>
